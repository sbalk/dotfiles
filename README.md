# ğŸ  basnijholt's dotfiles

<img src="https://github.com/user-attachments/assets/8aeb6c8f-0cdc-4e04-a279-f70b3000ead7" align="right" style="width: 350px;" />

A carefully designed cross-platform dotfiles configuration that powers my development environments across macOS ï£¿ and Linux ğŸ§ systems.
This repository represents years of refinement to create a consistent, modular, and reliable setup.

I run this configuration on at least 10 machines, including `arm64` *macOS*, `x86_64` and `aarm64` versions of *Ubuntu*, *Debian*, *DietPi*, *Raspberry Pi OS*, and even on my *iPhone* via iSH which emulates `i386` Linux.

My main goal is to have consistency and a super smooth bootstrapping experience for new machines, and to have a consistent setup across all my devices.

> [!TIP]
> I have written several blog posts about my shell setup and the tools I use.
> See [Be a Ninja in the Terminal ğŸ¥·](https://www.nijho.lt/post/terminal-ninja/), [dotbins: Managing Binary Tools in Your Dotfiles ğŸ§°](https://www.nijho.lt/post/dotbins/), and [Combining Keychain and 1Password CLI for SSH Agent Management ğŸ”‘](https://www.nijho.lt/post/ssh-1password-funtoo-keychain/) for more details.

> [!NOTE]
> I have maintained this repository since 2019-04 but started a new commit history when I made it public in 2025-04.

> [!NOTE]
> Nearly all code snippets in this README are auto-generated by [markdown-code-runner](https://github.com/basnijholt/markdown-code-runner).
> Therefore, the code *should* be up-to-date.

## âœ¨ Features

- **Shell agnostic** - Works with both `zsh` and `bash`
- **Cross-platform** - Supports macOS and Linux
- **Modular design** - Organized in independent, composable configuration files
- **Easy installation** - Uses [dotbot](https://github.com/anishathalye/dotbot) for automated symlink management
- **Binary management** - Uses [dotbins](https://github.com/basnijholt/dotbins) for CLI tools with automatic shell integration
- **Remote syncing** - Includes scripts to sync dotfiles across machines
- **nix-darwin integration** - Uses Nix for declarative macOS configuration

## ğŸ’– My favorite things

There is a lot of stuff in this repository, but things I won't go without are:

- I clone this repository and run `./install`, and everything is set up automatically!
- [oh-my-zsh](https://ohmyz.sh/) for all of the convenient default keybindings and plugins (yes, I know it's bloated and slow)
- [zsh-autosuggestions](https://github.com/zsh-users/zsh-autosuggestions) for command completion
- [starship](https://starship.rs/) for a beautiful prompt
- [dotbins](https://github.com/basnijholt/dotbins) for managing binaries
- [dotbot](https://github.com/anishathalye/dotbot) for managing symlinks and installing Python tools with `uv`
- [keychain](https://www.funtoo.org/Funtoo:Keychain) for SSH key management
- [direnv](https://github.com/direnv/direnv/) for managing environment variables (especially for Python (`uv` and `micromamba`))
- [zoxide](https://github.com/ajeetdsouza/zoxide) for jumping around directories (alternative to [`zsh-z`](https://github.com/agkozak/zsh-z))
- [Keyboard Maestro](https://www.keyboardmaestro.com/) for keyboard shortcuts to switch between applications
- [zsh-syntax-highlighting](https://github.com/zsh-users/zsh-syntax-highlighting) for syntax highlighting
- [nix-darwin](https://github.com/nix-darwin/nix-darwin) for declarative macOS configuration

Why not?

- I don't use `fish` because I want to be fully compatible with `bash`, so therefore I use `zsh` as my main shell.
- Why not **X**? I go over my design goals and decisions in [this blog post](https://www.nijho.lt/post/dotfiles). 

## ğŸš€ Quick Start

### Prerequisites

First, you need to set up SSH authentication to access private submodules.

<details>
<summary><b>Using 1Password</b></summary>

Install 1Password and set up the SSH agent:

```bash
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock
```

</details>

### Installation

```bash
# Clone the repository with submodules
git clone --recurse-submodules -j8 git@github.com:basnijholt/dotfiles.git
cd dotfiles

# Run the installation script
./install
```

### Update Remote Machines

```bash
# Sync dotfiles to all configured remote hosts
./scripts/sync-dotfiles.sh

# Or install new configuration on remotes
./scripts/sync-dotfiles.sh install
```

## ğŸ§© Repository Structure

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/repo_structure.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
.
â”œâ”€â”€ LICENSE
â”œâ”€â”€ README.md
â”œâ”€â”€ configs                          # Configuration files for various tools
â”‚   â”œâ”€â”€ atuin                        # Shell history management
â”‚   â”œâ”€â”€ bash                         # Bash-specific configuration
â”‚   â”œâ”€â”€ conda                        # Conda/Mamba configuration
â”‚   â”œâ”€â”€ dask                         # Dask distributed computing
â”‚   â”œâ”€â”€ direnv                       # Directory-specific environment setup
â”‚   â”œâ”€â”€ git                          # Git configuration
â”‚   â”œâ”€â”€ iterm                        # iTerm2 profiles
â”‚   â”œâ”€â”€ karabiner                    # Keyboard customization for macOS
â”‚   â”œâ”€â”€ keyboard-maestro             # Keyboard Maestro macros and configurations
â”‚   â”œâ”€â”€ mamba                        # Mamba package manager settings
â”‚   â”œâ”€â”€ nix-darwin                   # Nix configuration for macOS
â”‚   â”œâ”€â”€ shell                        # Shell-agnostic configurations
â”‚   â”œâ”€â”€ starship                     # Cross-shell prompt
â”‚   â”œâ”€â”€ syncthing                    # File synchronization
â”‚   â””â”€â”€ zsh                          # Zsh-specific configuration
â”œâ”€â”€ install                          # Installation script
â”œâ”€â”€ install.conf.yaml                # Dotbot configuration
â”œâ”€â”€ submodules                       # Git submodules for external tools
â”‚   â”œâ”€â”€ autoenv
â”‚   â”œâ”€â”€ dotbins                      # Binaries manager in dotfiles
â”‚   â”œâ”€â”€ dotbot                       # Dotfiles installation
â”‚   â”œâ”€â”€ keychain                     # SSH key management
â”‚   â”œâ”€â”€ mydotbins                    # CLI tool binaries managed by dotbins
â”‚   â”œâ”€â”€ oh-my-zsh                    # Zsh framework
â”‚   â”œâ”€â”€ rsync-time-backup
â”‚   â”œâ”€â”€ syncthing-resolve-conflicts
â”‚   â”œâ”€â”€ tmux                         # oh-my-tmux configuration
â”‚   â”œâ”€â”€ truenas-zfs-unlock
â”‚   â”œâ”€â”€ zsh-autosuggestions          # Zsh autosuggestions plugin
â”‚   â”œâ”€â”€ zsh-fzf-history-search       # Fuzzy history search
â”‚   â”œâ”€â”€ zsh-syntax-highlighting      # Zsh syntax highlighting
â”‚   â””â”€â”€ zsh-z
â””â”€â”€ uninstall.py                     # Uninstallation script
```

<!-- OUTPUT:END -->

## ğŸ“‹ Shell Configuration

The shell configuration is structured in a modular way under [`configs/shell/`](configs/shell/). The main entry point is [`main.sh`](configs/shell/main.sh) which sources other shell-specific files in a specific order:

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/shell_files.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
configs/shell
â”œâ”€â”€ 00_prefer_zsh.sh       # ZSH auto-switching
â”œâ”€â”€ 05_zsh_completions.sh  # ZSH completions setup
â”œâ”€â”€ 10_aliases.sh          # Shell aliases
â”œâ”€â”€ 20_exports.sh          # Environment variables
â”œâ”€â”€ 30_misc.sh             # Miscellaneous settings
â”œâ”€â”€ 40_keychain.sh         # SSH key management
â”œâ”€â”€ 50_python.sh           # Python environment setup
â”œâ”€â”€ 60_slurm.sh            # HPC cluster integration
â”œâ”€â”€ 70_zsh_plugins.sh      # ZSH plugins setup
â””â”€â”€ main.sh                # Main shell configuration file
```

<!-- OUTPUT:END -->

This modular approach makes it easy to understand, maintain, and customize each aspect of the shell environment.

This setup allows my `.zshrc` to be as simple as:

<!-- CODE:BASH:START -->
<!-- echo '```bash' -->
<!-- cat configs/zsh/zshrc -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
# zmodload zsh/zprof # Uncomment for profiling

source ~/dotfiles/configs/shell/main.sh

# zprof # Uncomment for profiling
```

<!-- OUTPUT:END -->

and `.bash_profile` to be:

<!-- CODE:BASH:START -->
<!-- echo '```bash' -->
<!-- cat configs/bash/bash_profile -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
source ~/dotfiles/configs/shell/main.sh
```

<!-- OUTPUT:END -->

## ğŸ”§ Key Components

### Shell Integration

- **Zsh** - Primary shell with Oh-My-Zsh, custom theme, and plugins
- **Bash** - Fallback shell with compatible configuration
- **Automatic shell detection** - Switches to Zsh automatically if available

### Development Tools

- **Git** - Comprehensive Git configuration with signing, aliases, and more
- **Python** - Support for conda/mamba/micromamba environments
- **Direnv** - Directory-specific environment variables
- **SSH** - Key management with keychain integration

### macOS Enhancements

- **nix-darwin** - Declarative system configuration
- **Homebrew** - Package management via Nix
- **Karabiner** - Keyboard customization
- **iTerm2** - Terminal customization

### Utility Scripts

The repository includes several useful utility scripts:

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/utility_scripts.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
scripts
â”œâ”€â”€ eqMac.py
â”œâ”€â”€ eqMac.sh                   # Poor man's Supervisord/Launchd/Systemd for eqMac because it keeps crashing
â”œâ”€â”€ nbviewer.sh                # Script to share Jupyter notebooks via nbviewer
â”œâ”€â”€ pypi-sha256.sh             # Generate the commands to update a conda-forge feedstock
â”œâ”€â”€ rclone.sh                  # Scheduled backups to B2 cloud storage
â”œâ”€â”€ rpi
â”œâ”€â”€ rsync-time-machine.sh      # Create incremental Time Machine-like backups using rsync
â”œâ”€â”€ signature.html
â”œâ”€â”€ sync-dotfiles.sh           # Sync dotfiles to remote machines
â”œâ”€â”€ sync-local-dotfiles.sh     # Update dotfiles on the local machine
â”œâ”€â”€ sync-photos-to-truenas.sh  # Sync photos to TrueNAS server
â””â”€â”€ upload-file.sh             # Share files via various file hosting services
```

<!-- OUTPUT:END -->

## ğŸ”¨ dotbins Integration

This repository uses [dotbins](https://github.com/basnijholt/dotbins) to manage CLI tools across platforms. The `dotbins.yaml` configuration defines both the tools to install and their shell integration:

<!-- CODE:BASH:START -->
<!-- echo '```yaml' -->
<!-- bat -r :30 submodules/dotbins/dotbins.yaml -->
<!-- echo '  # ... and more' -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```yaml
tools_dir: ~/.dotbins

platforms:
  linux:
    - amd64
    - arm64
  macos:
    - arm64

tools:
  delta: dandavison/delta
  duf: muesli/duf
  dust: bootandy/dust
  fd: sharkdp/fd
  git-lfs: git-lfs/git-lfs
  hyperfine: sharkdp/hyperfine
  rg: BurntSushi/ripgrep
  yazi: sxyazi/yazi

  atuin:
    repo: atuinsh/atuin
    shell_code:
      bash,zsh: |
        eval "$(atuin init __DOTBINS_SHELL__ --disable-up-arrow)"
  bat:
    repo: sharkdp/bat
    shell_code:
      bash,zsh: |
        alias bat="bat --paging=never"
        alias cat="bat --plain --paging=never"
  # ... and more
```

<!-- OUTPUT:END -->

dotbins automatically:

1. Downloads binaries for your platform
2. Organizes them by OS and architecture
3. Creates shell integration scripts with your custom aliases and initialization code
4. Updates all tools with a single command

The generated shell script at [`~/.dotbins/shell/zsh.sh`](https://github.com/basnijholt/.dotbins/blob/main/shell/zsh.sh) is sourced in your shell configuration, making all tools immediately available with their proper setup.

See the output of `dotbins status` below:

<!-- CODE:BASH:START -->
<!-- echo '```bash' -->
<!-- dotbins status -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
âœ… Loading configuration from: ~/.config/dotbins/config.yaml
                            âœ… Installed Tools Summary                            
â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Tool       â”ƒ Version(s) â”ƒ Platforms                             â”ƒ Last Updated â”ƒ
â”¡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ atuin      â”‚ 18.4.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ bat        â”‚ 0.25.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ delta      â”‚ 0.18.2     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ direnv     â”‚ 2.35.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ duf        â”‚ 0.8.1      â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ dust       â”‚ 1.2.0      â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d22h        â”‚
â”‚ eza        â”‚ 0.21.0     â”‚ linux/amd64, linux/arm64              â”‚ 3d4h         â”‚
â”‚ fd         â”‚ 10.2.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ fzf        â”‚ 0.61.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ git-lfs    â”‚ 3.6.1      â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ hyperfine  â”‚ 1.19.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ lazygit    â”‚ 0.48.0     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ micromamba â”‚ 2.0.8-0    â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ rg         â”‚ 14.1.1     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ starship   â”‚ 1.22.1     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ uv         â”‚ 0.6.12     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d           â”‚
â”‚ yazi       â”‚ 25.3.2     â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â”‚ zoxide     â”‚ 0.9.7      â”‚ linux/amd64, linux/arm64, macos/arm64 â”‚ 3d23h        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜


âŒ Missing Tools (defined in config but not installed)
â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”³â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
â”ƒ Tool â”ƒ Repository        â”ƒ Platform â”ƒ Architecture â”ƒ
â”¡â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â•‡â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”©
â”‚ eza  â”‚ eza-community/eza â”‚ macos    â”‚ arm64        â”‚
â””â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Tip: Run dotbins sync to install missing tools
```

<!-- OUTPUT:END -->


## ğŸ–¥ï¸ Platform-Specific Features

### macOS

Before running Nix-darwin, set the hostname:

```bash
NAME="basnijholt-macbook-pro"
sudo scutil --set HostName $NAME
sudo scutil --set LocalHostName $NAME
sudo scutil --set ComputerName $NAME
dscacheutil -flushcache
```

The repository includes nix-darwin configuration for a reproducible macOS setup:

```bash
# Install Nix
curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install

# Apply nix-darwin configuration
nixswitch  # Alias for darwin-rebuild switch --flake ~/dotfiles/configs/nix-darwin
```

#### Homebrew packages

The nix-darwin configuration manages Homebrew packages declaratively.
See the [`configs/nix-darwin/homebrew.nix`](`configs/nix-darwin/homebrew.nix`) file for the list of packages.

### Linux

For Linux systems, the configuration automatically adapts to the available environment and provides compatibility with various distributions.

## ğŸ”„ Syncing to Remote Machines

The repository includes scripts to easily sync your dotfiles to remote machines:

```bash
# Sync to all configured remote hosts
./scripts/sync-dotfiles.sh

# Install configuration on remotes (re-run dotbot)
./scripts/sync-dotfiles.sh install
```

## ğŸ” Secrets Management

Sensitive information is stored in a separate private repository with additional encryption using GPG and [git-secret](https://github.com/sobolevn/git-secret). The structure is as follows:

```
secrets/             # Private git submodule
â””â”€â”€ install          # Installation script for secrets
```

This submodule requires SSH authentication to access, which is why setting up SSH keys as described in the prerequisites is essential.

## ğŸ” Customization

To customize these dotfiles for your own use:

1. Fork this repository
2. Remove the `secrets` submodule
3. Update Git configurations with your information in `configs/git/`
4. Modify shell configurations in `configs/shell/`
5. Adjust the `install.conf.yaml` to match your needs
6. Update the dotbins.yaml configuration with your preferred tools
7. Remove or modify platform-specific configurations as necessary

## ğŸ“š Additional Resources

- [dotbot repo](https://github.com/anishathalye/dotbot)
- [dotbins repo](https://github.com/basnijholt/dotbins)
- [nix-darwin repo](https://github.com/nix-darwin/nix-darwin)
- [oh-my-tmux repo](https://github.com/gpakosz/.tmux)
- [oh-my-zsh repo](https://github.com/ohmyzsh/ohmyzsh)

## ğŸ“„ License

This project is open-source and available under the MIT License.
