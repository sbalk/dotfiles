# ðŸ  basnijholt's dotfiles

A carefully designed cross-platform dotfiles configuration that powers my development environments across macOS and Linux systems.
This repository represents years of refinement to create a consistent, modular, and reliable setup.

I run this configuration on at least 10 machines, including `arm64` *macOS*, `x86_64` and `aarm64` versions of *Ubuntu*, *Debian*, *DietPi*, *Raspberry Pi OS*, and even on my *iPhone* via iSH which emulates `i386` Linux.

My main goal is to have consistency and a super smooth bootstrapping experience for new machines, and to have a consistent setup across all my devices.

> [!TIP]
> I have written several blog posts about my shell setup and the tools I use.
> See [Be a Ninja in the Terminal ðŸ¥·](https://www.nijho.lt/post/terminal-ninja/), [dotbins: Managing Binary Tools in Your Dotfiles ðŸ§°](https://www.nijho.lt/post/dotbins/), and [Combining Keychain and 1Password CLI for SSH Agent Management ðŸ”‘](https://www.nijho.lt/post/ssh-1password-funtoo-keychain/) for more details.

> [!NOTE]
> I have maintained this repository since 2019-04 but started a new commit history when I made it public in 2025-04.

## âœ¨ Features

- **Shell agnostic** - Works with both `zsh` and `bash`
- **Cross-platform** - Supports macOS and Linux
- **Modular design** - Organized in independent, composable configuration files
- **Easy installation** - Uses [dotbot](https://github.com/anishathalye/dotbot) for automated symlink management
- **Binary management** - Uses [dotbins](https://github.com/basnijholt/dotbins) for CLI tools with automatic shell integration
- **Remote syncing** - Includes scripts to sync dotfiles across machines
- **nix-darwin integration** - Uses Nix for declarative macOS configuration
- **Isolated environments** - Supports direnv, micromamba, and other environment managers

## ðŸš€ Quick Start

### Prerequisites

First, you need to set up SSH authentication to access private submodules.

<details>
<summary><b>Using 1Password</b></summary>

Install 1Password and set up the SSH agent:

```bash
export SSH_AUTH_SOCK=~/Library/Group\ Containers/2BUA8C4S2C.com.1password/t/agent.sock
```

</details>

### Installation

```bash
# Clone the repository with submodules
git clone --recurse-submodules -j8 git@github.com:basnijholt/dotfiles.git
cd dotfiles

# Run the installation script
./install
```

### Update Remote Machines

```bash
# Sync dotfiles to all configured remote hosts
./scripts/sync-dotfiles.sh

# Or install new configuration on remotes
./scripts/sync-dotfiles.sh install
```

## ðŸ§© Repository Structure

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/repo_structure.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
.
â”œâ”€â”€ README.md
â”œâ”€â”€ configs                          # Configuration files for various tools
â”‚   â”œâ”€â”€ atuin                        # Shell history management
â”‚   â”œâ”€â”€ bash                         # Bash-specific configuration
â”‚   â”œâ”€â”€ conda                        # Conda/Mamba configuration
â”‚   â”œâ”€â”€ dask                         # Dask distributed computing
â”‚   â”œâ”€â”€ direnv                       # Directory-specific environment setup
â”‚   â”œâ”€â”€ git                          # Git configuration
â”‚   â”œâ”€â”€ iterm                        # iTerm2 profiles
â”‚   â”œâ”€â”€ karabiner                    # Keyboard customization for macOS
â”‚   â”œâ”€â”€ keyboard-maestro             # Keyboard Maestro macros and configurations
â”‚   â”œâ”€â”€ mamba                        # Mamba package manager settings
â”‚   â”œâ”€â”€ nix-darwin                   # Nix configuration for macOS
â”‚   â”œâ”€â”€ shell                        # Shell-agnostic configurations
â”‚   â”œâ”€â”€ starship                     # Cross-shell prompt
â”‚   â”œâ”€â”€ syncthing                    # File synchronization
â”‚   â””â”€â”€ zsh                          # Zsh-specific configuration
â”œâ”€â”€ install                          # Installation script
â”œâ”€â”€ install.conf.yaml                # Dotbot configuration
â”œâ”€â”€ submodules                       # Git submodules for external tools
â”‚   â”œâ”€â”€ autoenv
â”‚   â”œâ”€â”€ dotbins                      # Binaries manager in dotfiles
â”‚   â”œâ”€â”€ dotbot                       # Dotfiles installation
â”‚   â”œâ”€â”€ keychain                     # SSH key management
â”‚   â”œâ”€â”€ mydotbins                    # CLI tool binaries managed by dotbins
â”‚   â”œâ”€â”€ oh-my-zsh                    # Zsh framework
â”‚   â”œâ”€â”€ rsync-time-backup
â”‚   â”œâ”€â”€ syncthing-resolve-conflicts  # File synchronization
â”‚   â”œâ”€â”€ tmux                         # oh-my-tmux configuration
â”‚   â”œâ”€â”€ truenas-zfs-unlock
â”‚   â”œâ”€â”€ zsh-autosuggestions          # Zsh-specific configuration
â”‚   â”œâ”€â”€ zsh-fzf-history-search       # Zsh-specific configuration
â”‚   â”œâ”€â”€ zsh-syntax-highlighting      # Zsh-specific configuration
â”‚   â””â”€â”€ zsh-z                        # Zsh-specific configuration
â””â”€â”€ uninstall.py                     # Uninstallation script
```

<!-- OUTPUT:END -->

## ðŸ“‹ Shell Configuration

The shell configuration is structured in a modular way under `configs/shell/`. The main entry point is `main.sh` which sources other shell-specific files in a specific order:

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/shell_files.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
configs/shell
â”œâ”€â”€ 00_prefer_zsh.sh       # ZSH auto-switching
â”œâ”€â”€ 05_zsh_completions.sh  # ZSH completions setup
â”œâ”€â”€ 10_aliases.sh          # Shell aliases
â”œâ”€â”€ 20_exports.sh          # Environment variables
â”œâ”€â”€ 30_misc.sh             # Miscellaneous settings
â”œâ”€â”€ 40_keychain.sh         # SSH key management
â”œâ”€â”€ 50_python.sh           # Python environment setup
â”œâ”€â”€ 60_slurm.sh            # HPC cluster integration
â”œâ”€â”€ 70_zsh_plugins.sh      # ZSH plugins setup
â””â”€â”€ main.sh                # Main shell configuration file
```

<!-- OUTPUT:END -->

This modular approach makes it easy to understand, maintain, and customize each aspect of the shell environment.

This setup allows my `.zshrc` to be as simple as:

<!-- CODE:BASH:START -->
<!-- echo '```bash' -->
<!-- cat configs/zsh/zshrc -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
# zmodload zsh/zprof # Uncomment for profiling

source ~/dotfiles/configs/shell/main.sh

# zprof # Uncomment for profiling
```

<!-- OUTPUT:END -->

and `.bash_profile` to be:

<!-- CODE:BASH:START -->
<!-- echo '```bash' -->
<!-- cat configs/bash/bash_profile -->
<!-- echo '```' -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
source ~/dotfiles/configs/shell/main.sh
```

<!-- OUTPUT:END -->

## ðŸ”§ Key Components

### Shell Integration

- **Zsh** - Primary shell with Oh-My-Zsh, custom theme, and plugins
- **Bash** - Fallback shell with compatible configuration
- **Automatic shell detection** - Switches to Zsh automatically if available

### Development Tools

- **Git** - Comprehensive Git configuration with signing, aliases, and more
- **Python** - Support for conda/mamba/micromamba environments
- **Direnv** - Directory-specific environment variables
- **SSH** - Key management with keychain integration

### macOS Enhancements

- **nix-darwin** - Declarative system configuration
- **Homebrew** - Package management via Nix
- **Karabiner** - Keyboard customization
- **iTerm2** - Terminal customization

### Utility Scripts

The repository includes several useful utility scripts:

<!-- CODE:BASH:START -->
<!-- python3 .github/scripts/utility_scripts.py -->
<!-- CODE:END -->

<!-- OUTPUT:START -->
<!-- âš ï¸ This content is auto-generated by `markdown-code-runner`. -->
```bash
scripts
â”œâ”€â”€ eqMac.py
â”œâ”€â”€ eqMac.sh                   # Poor man's Supervisord/Launchd/Systemd for eqMac because it keeps crashing
â”œâ”€â”€ nbviewer.sh                # Script to share Jupyter notebooks via nbviewer
â”œâ”€â”€ pypi-sha256.sh             # Generate the commands to update a conda-forge feedstock
â”œâ”€â”€ rclone.sh                  # Scheduled backups to B2 cloud storage
â”œâ”€â”€ rpi
â”œâ”€â”€ rsync-time-machine.sh      # Create incremental Time Machine-like backups using rsync
â”œâ”€â”€ signature.html
â”œâ”€â”€ sync-dotfiles.sh           # Sync dotfiles to remote machines
â”œâ”€â”€ sync-local-dotfiles.sh     # Update dotfiles on the local machine
â”œâ”€â”€ sync-photos-to-truenas.sh  # Sync photos to TrueNAS server
â””â”€â”€ upload-file.sh             # Share files via various file hosting services
```

<!-- OUTPUT:END -->

## ðŸ”¨ dotbins Integration

This repository uses [dotbins](https://github.com/basnijholt/dotbins) to manage CLI tools across platforms. The `dotbins.yaml` configuration defines both the tools to install and their shell integration:

```yaml
tools_dir: ~/.dotbins

tools:
  # Simple tools that need no special configuration
  delta: dandavison/delta
  fd: sharkdp/fd
  rg: BurntSushi/ripgrep

  # Tools with custom shell integration
  bat:
    repo: sharkdp/bat
    shell_code:
      zsh: |
        alias bat="bat --paging=never"
        alias cat="bat --plain --paging=never"
  fzf:
    repo: junegunn/fzf
    shell_code:
      zsh: |
        source <(fzf --zsh)
  # ...and more
```

dotbins automatically:

1. Downloads binaries for your platform
2. Organizes them by OS and architecture
3. Creates shell integration scripts with your custom aliases and initialization code
4. Updates all tools with a single command

The generated shell script at `~/.dotbins/shell/zsh.sh` is sourced in your shell configuration, making all tools immediately available with their proper setup.

## ðŸ–¥ï¸ Platform-Specific Features

### macOS

Before running Nix-darwin, set the hostname:

```bash
NAME="basnijholt-macbook-pro"
sudo scutil --set HostName $NAME
sudo scutil --set LocalHostName $NAME
sudo scutil --set ComputerName $NAME
dscacheutil -flushcache
```

The repository includes nix-darwin configuration for a reproducible macOS setup:

```bash
# Install Nix
curl --proto '=https' --tlsv1.2 -sSf -L https://install.determinate.systems/nix | sh -s -- install

# Apply nix-darwin configuration
nixswitch  # Alias for darwin-rebuild switch --flake ~/dotfiles/configs/nix-darwin
```

#### Homebrew packages

The nix-darwin configuration manages Homebrew packages declaratively.
See the [`configs/nix-darwin/homebrew.nix`](`configs/nix-darwin/homebrew.nix`) file for the list of packages.

### Linux

For Linux systems, the configuration automatically adapts to the available environment and provides compatibility with various distributions.

## ðŸ”„ Syncing to Remote Machines

The repository includes scripts to easily sync your dotfiles to remote machines:

```bash
# Sync to all configured remote hosts
./scripts/sync-dotfiles.sh

# Install configuration on remotes (re-run dotbot)
./scripts/sync-dotfiles.sh install
```

## ðŸ” Secrets Management

Sensitive information is stored in a separate private repository with additional encryption using GPG and [git-secret](https://github.com/sobolevn/git-secret). The structure is as follows:

```
secrets/             # Private git submodule
â””â”€â”€ install          # Installation script for secrets
```

This submodule requires SSH authentication to access, which is why setting up SSH keys as described in the prerequisites is essential.

## ðŸ” Customization

To customize these dotfiles for your own use:

1. Fork this repository
2. Update Git configurations with your information in `configs/git/`
3. Modify shell configurations in `configs/shell/`
4. Adjust the `install.conf.yaml` to match your needs
5. Update the dotbins.yaml configuration with your preferred tools
6. Remove or modify platform-specific configurations as necessary

## ðŸ“š Additional Resources

- [dotbot documentation](https://github.com/anishathalye/dotbot)
- [dotbins documentation](https://github.com/basnijholt/dotbins)
- [nix-darwin documentation](https://github.com/LnL7/nix-darwin)

## ðŸ“„ License

This project is open-source and available under the MIT License.
